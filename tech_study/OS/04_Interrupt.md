# 인터럽트 (Interrupt)

## Table of Contents
* [인터럽트의 개념](#인터럽트란)

### 인터럽트란?
cpu가 입출력 장치에 데이터를 읽거나 쓰려고 하는 상황을 생각해보겠습니다.
cpu는 입출력 작업이 들어오면 입출력 관리자에게 명령을 내림
cpu관점에서 입출력 명령이 언제 끝날지 모르기떄문에
주기적으로 확인해줘야 함
## 인터럽트
### 폴링 (polling) 방식
* CPU가 직접 입출력장치에서 데이터를 가져오거나 내보내는 방식
* CPU가 입출력장치의 상태를 주기적으로 검사하여 일정한 조건을 만족할 때 데이터를 처리
* CPU가 명령어 해석과 실행이라는 본래 역할 외에 모든 입출력까지 관여하므로 작업 효율 떨어짐

### 인터럽트 (interrupt) 방식
* 입출력 관리자가 대신 입출력을 해주는 방식
* CPU의 작업과 저장장치의 데이터 이동을 독립적으로 운영함으로서 시스템의 효율을 높임
* 데이터의 입출력이 이루어지는 동안 CPU가 다른 작업을 할 수 있음

### 인터럽트
* 입출력 관리자가 CPU에 보내는 완료 신호
### 인터럽트 번호
* 많은 주변장치 중 어떤 것의 작업이 끝났는지를 CPU에 알려주기 위해 사용
* 윈도우 운영체제에서는 IRQ라 부름
### 인터럽트 벡터
* 여러 개의 입출력 작업을 한꺼번에 처리하기 위해 여러 개의 인터럽트를 하나의 배열로 만든 것
### 인터럽트 방식의 동작 과정
<img src="https://velog.velcdn.com/images/minseong1459/post/b301648f-fac0-4f29-9bb8-d57d34b3ddb4/image.jpeg">

이러한 방식을 폴링 방식이라고 함
폴링방식의 단점은 주기적으로 CPU가 확인해줘야해서 성능이 좋지않음

인터럽트는 폴링방식의 단점을 해결한 방식
CPU가 입출력 관리자에게 입출력 명령을 내리고 CPU는 다른 작업을 함

입출력 관리자는 입출력이 완료되었을 때 CPU에게 신호를 주고 CPU는 그 신호를 받으면
인터럽트 서비스 루틴(ISR)을 받아 작업을 완료함
ISR은 특정 인터럽트가 들어오면 그 인터럽트를 처리하는 함수
인터럽트는 비동기적으로 동작하기 때문에 성능에 이점

인터럽트는 하드웨어와 소프트웨어의 2가지 방식이 있음
하드웨어 방식은 조금 전의 설명한 입출력 등과 같은 인터럽트
소프트웨어 방식은 사용자 프로그램에서 발생한 인터럽트가 있음
(예를 들어 유효하지 않는 메모리에 접근하거나 0으로 나눈 경우)


---

곰책 기준
인터럽트

https://raisode.tistory.com/
인터럽트란 사전적 의미로는 '끼어들다', '중단시키다' 정도의 의미를 가진 말로 프로그램을 실행하는 도중에 예기치 않은 상황이
발생할 경우 현재 실행중인 작업을 중단하고 발생된 상황을 처리한 후 다시 실행중인 작업으로 복귀하는 것을 말함

인터럽트의 종류
인터럽트의 종류는 외부 인터럽트, 내부 인터럽트, 소프트웨어 인터럽트로 나뉠 수 있다.

## 외부 인터럽트
* 전원 이상 인터럽트 (Power Fall Interrupt) : 말그대로 정전, 파워 이상등
* 기계 착오 인터럽트 (Machine check interrupt) : CPU의 기능적인 오류
* 외부 신호 인터럽트 (External interrupt) 
    - 타이머에 의한 인터럽트 : Preemptive 개념을 생각하면 된다. 자원이 할당된 시간이 다 끝난 경우
    - 키보드로 인터럽트 키를 누른 경우 : 대표적으로 Control + Alt + Delete
    - 외부장치로부터 인터럽트 요청이 있는 경우 "I/O 인터럽트 아님!!" 다른 개념이다
* 입출력 인터럽트
    - 입출력장치가 데이터 전송을 요구하거나 전송이 끝나 다음 동작이 수행되어야 할 경우
    - 입출력 데이터에 이상이 있는 경우

## 내부 인터럽트
* 잘못된 명령이나 잘못된 데이터를 사용할 때 발생하여 Trap이라 부른다.
* 프로그램 검사 인터럽트 (Program Check Interrupt)
    - Division By Zero
    - Overflow/Underflow
    - 기타 Exception
* 소프트웨어적이 내용이나 분류상 인터럽트가 아니다!

## 소프트웨어 인터럽트 (SVC : SuperVisor Call)
* 사용자가 프로그램을 실행시키거나 감시프로그램(SuperVisor)을 호출하는 동작을 수행하는 경우
* 소프트웨어 이용중 다른 프로세스를 실행시키면 시분할 처리를 위해 자원 할당 등의 동작이 수행된다.

## 인터럽트 동작 순서
1. 인터럽트 요청
2. 프로그램 실행 중단 : 현재 실행중이던 Micro Operation까지 수행한다.
3. 현재의 프로그램 상태 보존 : PCB(Process Control Block), PC(Program Counter) 등
4. 인터럽트 처리루틴 실행 : 인터럽트를 요청한 장치를 식별한다.
5. 인터럽트 서비스 루틴 실행 : 인터럽트 원인을 파악하고 실질적인 작업을 수행한다. 처리기 레지스터 상태를 보존한다. 서비스 루틴 수행 중 우선순위가 더 높은 인터럽트가 발생하면 또 재귀적으로 1~5를 수행한다.
6. 상태복구 : 인터럽트 발생 시 저장해둔 PC(Program Counter)를 다시 복구한다.
7. 중단된 프로그램 실행 재개 : PC의 값을 이용하여 이전에 수행중이던 프로그램을 재개한다.

## 인터럽트 우선순위
<font color="grey">여러 장치에서 인터럽트가 동시에 발생하거나 인터럽트 서비스 루틴 수행 중 인터럽트가 발생했을 경우 우선순위를 따져서 처리한다.</font>

>전원이상 (Power Fall) > 기계 착오 (Machine Check) > 외부 신호 (External) > 입출력 (I/O) > 명령어 잘못 > 프로그램 검사(Program Check) > SVC (SuperVisor Call)

일반적으로 하드웨어 인터럽트가 소프트웨어 인터럽트보다 우선 순위가 높고 내부 인터럽트 보다 외부 인터럽트가 우선 순위가 높다


 