# DeadLock (교착 상태)

## 교착상태
* 멀티프로세스 시스템에서 발생할 수 있는 문제로, 각각의 프로세스가 다른 프로세스가 가진 자원을 기다리며 무한히 대기하는 상태를 말합니다. 이 상태에서는 어떤 프로세스도 진행하지 못하며, 시스템이 먹통이 되는 문제가 발생할 수 있습니다.

### 교착상태의 발생 조건

* 교착상태는 다음 네 가지 필요조건을 동시에 충족할 때 발생합니다
  1. 상호 배제 (Mutual Exclusion): 자원은 한 번에 하나의 프로세스만 사용할 수 있어야 합니다.
  2. 점유 대기 (Hold and Wait): 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당된 자원을 대기하고 있어야 합니다.
  3. 비선점 (No Preemption): 다른 프로세스에 할당된 자원은 해당 프로세스가 스스로 반납하기 전까지 강제로 빼앗을 수 없어야 합니다.
  4. 순환 대기 (Circular Wait): 각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 대기하고 있어야 합니다.

> 교착상태가 발생하면 시스템은 자원을 효율적으로 사용하지 못하고, 프로세스들은 진행하지 못하므로 작업이 멈추게 됩니다.

### 교착상태를 방지하는 방법

* 교착상태 예방 (Deadlock Prevention): 교착상태가 발생하는 필요조건 중 하나를 제거하여 교착상태를 예방하는 방법입니다. 예를 들어, 점유 대기 조건을 방지하기 위해 프로세스가 실행되기 전에 필요한 모든 자원을 한 번에 요청하도록 요구할 수 있습니다.
* 교착상태 회피 (Deadlock Avoidance): 시스템이 자원 할당을 결정할 때, 교착상태가 발생하지 않도록 하는 방법입니다. 프로세스가 자원을 요청할 때 시스템은 자원 할당 후에도 안전한 상태를 유지할 수 있는지에 대한 검사를 수행합니다.
* 자원 할당 그래프 (Resource Allocation Graph): 교착상태를 탐지하기 위한 그래프로, 프로세스와 자원 사이의 할당 관계를 나타냅니다. 싸이클이 존재하는 경우 교착상태가 발생했다고 판단할 수 있습니다.
* 자원 선점

### 교착상태 예방

* 상호 배제 (Mutual Exclusion) 방지: 자원을 공유할 수 있는 방법을 도입하여 여러 프로세스가 동시에 자원을 사용할 수 있도록 합니다. 예를 들어, 공유 자원에 대한 접근을 제한하는 뮤텍스나 세마포어와 같은 동기화 메커니즘을 사용할 수 있습니다.
* 점유 대기 (Hold and Wait) 방지: 프로세스가 실행되기 전에 필요한 모든 자원을 한 번에 요청하도록 하는 방법입니다. 프로세스는 자원을 요청하기 전에 필요한 모든 자원을 확보해야만 합니다. 이를 위해 프로세스가 모든 자원을 한 번에 요청하는 방식인 자원 요청 그래프 알고리즘을 사용할 수 있습니다.
* 비선점 (No Preemption) 방지: 프로세스가 자원을 점유하고 있는 동안에는 다른 프로세스에게 자원을 강제로 빼앗을 수 없도록 합니다. 이를 위해 프로세스가 자원을 사용하는 동안에는 다른 프로세스가 해당 자원을 요청할 수 없게 하거나, 자원의 상태를 저장하여 복원할 수 있는 방법을 사용합니다.
* 순환 대기 (Circular Wait) 방지: 자원에 고유한 번호를 할당하고, 프로세스는 순서대로 자원을 요청해야 합니다. 예를 들어, 모든 자원을 오름차순으로 요청하거나, 자원을 할당할 때 순서를 지켜야 하는 방식을 사용할 수 있습니다.

### 교착상태 회피

* 은행원 알고리즘 (Banker's Algorithm): 프로세스가 자원을 요청할 때 시스템은 자원을 할당한 뒤에도 안전한 상태를 유지할 수 있는지 사전에 검사합니다. 안전한 상태에만 자원을 할당하며, 그렇지 않을 경우에는 프로세스가 대기하도록 합니다. 이 알고리즘은 자원 요청에 대한 정보를 기반으로 자원의 사용 가능 여부를 예측하는 방식으로 교착상태를 회피합니다.

<br>

 <img src="https://t1.daumcdn.net/cfile/tistory/991CB0375C74142E14">


### 자원 할당 그래프

* 자원 할당 그래프를 사용하여 교착상태를 탐지합니다. 그래프에서 싸이클이 존재하면 교착상태가 발생했다고 판단합니다. 교착상태가 발견되면 시스템은 적절한 조치를 취하여 교착상태를 해결합니다. 예를 들어, 교착상태를 해결하기 위해 싸이클을 형성하는 프로세스 중 하나를 중지시키거나, 자원을 선점하여 교착상태를 해제할 수 있습니다.

<br>

<img src="https://static.javatpoint.com/operating-system/images/os-deadlock-detection-using-rag.png">

### 자원 선점

* 교착상태가 발생하면 시스템은 자원을 선점하여 교착상태를 해제할 수 있습니다. 다른 프로세스의 자원을 선점하여 현재 대기 중인 프로세스에게 할당하고, 교착상태를 방지합니다. 자원 선점은 프로세스의 우선순위를 기준으로 할 수도 있고, 임의로 자원을 선점할 수도 있습니다.

> 교착상태는 시스템 설계 단계부터 고려되어야 하며, 적절한 교착상태 방지 또는 해결 알고리즘을 사용하여 시스템의 안정성과 신뢰성을 보장해야 합니다.